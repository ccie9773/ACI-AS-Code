---
apic:
  tenants:
    - name: test

      vrfs:
        - name: vrf_dc

      bridge_domains:
        - name: bd1
          vrf: vrf_dc
          subnets:
            - ip: 192.168.99.1/24
              public: true
              shared: true

      application_profiles:
        - name: ap
          endpoint_groups:
            - name: epg1
              bridge_domain: bd1
              vmware_vmm_domains:
                - name: vds1-managed
              physical_domains:
                - all-physical-devices
              static_ports:
                - node_id: 1201
                  port: 11
                  vlan: 3099
                - node_id: 1202
                  port: 11
                  vlan: 3099
              contracts:
                consumers:
                  - permit-all

      filters:
        - name: permit-any
          entries:
            - name: any
              ethertype: ip
              protocol: unspecified

      contracts:
        - name: permit-all
          subjects:
            - name: any
              filters:
                - filter: permit-any

      policies:
        bfd_interface_policies:
          - name: bfd-enabled
            subinterface_optimization: true
        set_rules:
          - name: set-1
            community_mode: append
            community: regular:as2-nn2:100:900
        match_rules:
          - name: all-bds
            prefixes:
              - ip: 192.168.99.0/24
          - name: limited-subnets
            prefixes:
              - ip: 172.16.10.0/24
          - name: all-others
            prefixes:
              - ip: 0.0.0.0/0
                aggregate: true
                from_length: 0
                to_length: 32

                

      l3outs:
        - name: l3out
          vrf: vrf_dc
          domain: all-tenant-vrfs
          bfd_policy: bfd-enabled
          pim_polocies: pim-enabled
          l3_multicast_ipv4: true
          node_profiles:
            - name: l3out-nodes
              nodes:
                - node_id: 1203
                  router_id: 10.10.203.203
                  router_id_as_loopback: false
                  loopback: 10.10.253.253
                - node_id: 1204
                  router_id: 10.10.204.204
                  router_id_as_loopback: false
                  loopback: 10.10.254.254
              interface_profiles:
                - name: leaf1203
                  interfaces:
                    - node_id: 1203
                      port: 21
                      mtu: 9216
                      vlan: 191
                      svi: false
                      ip: 10.255.191.1/24
                      bgp_peers:
                        - ip: 10.255.191.2
                          remote_as: 300
                          allow_self_as: true
                          send_community: true
                          send_ext_community: true
                          bfd: true
                - name: leaf1204
                  interfaces:
                    - node_id: 1204
                      port: 21
                      mtu: 9216
                      vlan: 192
                      svi: false
                      ip: 10.255.192.1/24
                      bgp_peers:
                        - ip: 10.255.192.2
                          remote_as: 300
                          allow_self_as: true
                          send_community: true
                          send_ext_community: true
                          bfd: true
          external_endpoint_groups:
            - name: external
              subnets:
                - prefix: 172.16.0.0/24
              contracts:
                providers:
                  - permit-all
          export_route_map:
            contexts:
              - name: export-routes
                match_rule: all-bds
                set_rule: set-1
          import_route_map:
            contexts:
              - name: import-routes
                match_rule: limited-subnets
              - name: deny-routes
                match_rule: all-others
                action: deny



